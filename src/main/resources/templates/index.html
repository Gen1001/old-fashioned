<!DOCTYPE html>
<html lang="ja" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>トップページ</title>
    <div th:replace="~{fragment :: meta}"></div>
    <div th:replace="~{fragment :: styles}"></div>
</head>
<body class="home">
    <div class="oldfashioned-wrapper">
        <div th:replace="~{fragment :: header}"></div>
        <main>
            <div class="container oldfashined-container">
                <div class="row justify-content-center">
                    <div class="col">
                        <div class="container pt-4 pb-5">
                            <div th:if="${param.loggedIn}" class="alert alert-info">ログインしました。</div>
                            <div th:if="${successMessage}" class="alert alert-imfo">
                                <span th:text="${successMessage}"></span>
                            </div>
                        </div>
						
						<aside id="mainimg">
						
							<div class="slide slide1">
								<div>
									<h1 class="font-bebas">OLD FASHIONED</h1>
									<p>スタイリッシュなデザインで、<br>都会の街並みに映える最新メンズファッション。</p>
									<p class="btn-border-radius"><a href="bland.html#men">もっと詳しくみる</a></p>
								</div>
							</div>
								
							<div class="slide slide2">
								<div>
									<h1 class="font-gruppo">OLD FASHIONED</h1>
									<p>洗練されたシルエットとデザインで、<br>自分らしさを際立たせるウィメンズスタイル。</p>
									<p class="btn-border-radius"><a href="bland.html#women">もっと詳しくみる</a></p>
								</div>
							</div>
								
							<div class="slide slide3">
								<div>
									<h1 class="font-monoton">OLD FASHIONED</h1>
									<p>遊び心とおしゃれが融合した、<br>子供たちのためのトレンドファッション。</p>
									<p class="btn-border-radius"><a href="bland.html#kids">もっと詳しくみる</a></p>
								</div>
							</div>
						
						</aside>
						
						<div class="bg1">
						
							<section class="blur">
							
								<h2>Category</h2>
								
								<div class="list-grid1">
									<div class="list image-container" onmouseover="playVideo(this)" onmouseout="pauseVideo(this)">
										<a href="bland.html#men">
											<figure><img src="images/sample3.png" alt=""></figure>
											<video src="images/sample3.mp4" muted loop></video>
											<div class="text2 font-bebas">Vintage</div>
										</a>
									</div>
									
									<div class="list image-container" onmouseover="playVideo(this)" onmouseout="pauseVideo(this)">
										<a href="bland.html#women">
											<figure><img src="images/sample2.png" alt=""></figure>
											<video src="images/sample2.mp4" muted loop></video>
											<div class="text2 font-gruppo">Import</div>
										</a>
									</div>
									
									<div class="list image-container" onmouseover="playVideo(this)" onmouseout="pauseVideo(this)">
										<a href="bland.html#kids">
											<figure><img src="images/sample1.png" alt=""></figure>
											<video src="images/sample1.mp4" muted loop></video>
											<div class="text2 font-monoton">Used</div>
										</a>
									</div>
								</div>
							
							</section>
						
						</div>
						
						<section class="blur">
						
							<h2>Post List</h2>
							
							<div class="list-grid1">
								<div th:each="post : ${postPage}">
									<div class="list image-container2">
										<a th:href="@{/posts/__${post.getId()}__}">
										<figure><img th:src="@{clothes/__${post.getPostPhoto()}__}" alt="投稿画像"></figure>
										<div class="text2 font-bebas" th:text="${post.getName()}"></div>
										</a>
									</div>
								</div>
							</div>
						
						</section>
						
                        <!-- マップ -->
                        <div id="map"></div>
						
						<div class="bg1">
						
							<section>
							
							<h2 class="dn">ギャラリー</h2>
							
							<div class="thumbnail-slide">
								<a href="#"><img src="images/1.jpg" alt=""></a>
								<a href="#"><img src="images/2.jpg" alt=""></a>
								<a href="#"><img src="images/3.jpg" alt=""></a>
								<a href="#"><img src="images/1.jpg" alt=""></a>
								<a href="#"><img src="images/2.jpg" alt=""></a>
								<a href="#"><img src="images/3.jpg" alt=""></a>
							</div>
							
							</section>
						
						</div>
                      
                    </div>
                </div>
            </div>
        </main>
        <div th:replace="~{fragment :: footer}"></div>
    </div>
    <div th:replace="~{fragment :: scripts}"></div>
	<script type="text/javascript" th:inline="javascript">
		/*<![CDTA[*/
		var apiKey = /*[[${apiKey}]]*/'[]';
		var mapId = /*[[${mapId}]]*/'[]';
		(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
		    key: apiKey,
		    v: "week",
		});
		
		let map;
		
		async function initMap() {
			const { Map } = await google.maps.importLibrary("maps");
			const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
		
			//現在地を取得
		    if (navigator.geolocation) {
		        navigator.geolocation.getCurrentPosition(showPosition);
		    } else {
		        alert("Geolocation is not supported by this browser.");
		    }
			
			function showPosition(position) {
			    let coordinate = {
			        lat: position.coords.latitude,
			        lng: position.coords.longitude
			    };
				
				
			//地図の描画
			map = new Map(document.getElementById("map"), {
		    center: coordinate,
		    zoom: 8,
		    mapId: mapId,
		 	});
			
			var stores = /*[[${store}]]*/ '[]';
			stores = /*[[${store}]]*/ [];
		 	
		 	stores.forEach(function(store) {
				//店舗の投稿ページへ遷移
				const contentString =
				        '<div class="">' +
				        '<div class="mb5"><a href="/posts/storePage/' + store.id + '" class="btn btn-sm btn-default mb5">' +
				        '店舗の投稿を見る' +
				        '</a></div>' +
				        '</div>';
				  
				const infowindow = new google.maps.InfoWindow({
				    content: contentString,
				  });
				  
				//店舗名を表示する
			    const storeName = document.createElement("div");
			    storeName.className = "store-name";
			    storeName.textContent = store.name;
			    
			    //店舗の座標
			    let storePosition = { lat: store.latitude, lng: store.longitude };
				
			 	//マーカーの設置
			 	let marker = new AdvancedMarkerElement({
				map,
				position: storePosition,
				content: storeName,
				title: store.name,
				});
				
				//クリック時の処理
				marker.addListener("click", function() {
					infowindow.open({
						anchor: marker,
						map,
					})
				})
				
			});
			}
		}
		
		initMap();		
		/*]]>*/
	</script>
</body>
</html>
